<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/gridbox.css">
    <link rel="stylesheet" href="css/gridbox-grids.css">
    <link rel="stylesheet" href="css/gridbox-form.css">
    <link rel="stylesheet" href="css/gridbox-nav-default.css">
    <title>Navigation Bar</title>
</head>
<body>
    <div class="container-fluid">

        <nav class="nav nav-default nav-top">
            <!-- Brand Name -->
            <div class="brand">
                <div class="logo">
                    <img src="img/gridbox_logo.png" alt="">
                </div>
                <div class="brandname">
                    <!-- Brand name -->
                    <a href="#">Grixbox</a>
                </div>
                <!-- Menu Toggle on Mobile Devices -->
                <div class="menutoggle" id="menutoggler">
                    <span></span>
                </div>
            </div>
            <!-- Nav Menu -->
            <div class="navmenuwrap" id="navToggleTarget">
                <ul class="navmenu" id="nav">
                    <!-- Simple Menu Link -->
                    <li class="menuitem link"><a class="active" href="#">Home</a></li>
                    <!-- Dropdown Menu -->
                    <li class="menuitem link dropdown">
                        <a href="#">Product</a>
                        <ul class="navmenu-sub" id="subnav1">
                            <li class="link"><a href="#">Item 1</a></li>
                            <li class="link"><a href="#">Item 2</a></li>
                            <li class="link"><a href="#">Item 3</a></li>
                        </ul>
                    </li>
                    <li class="menuitem link dropdown">
                        <a href="#">About</a>
                        <ul class="navmenu-sub" id="subnav2">
                            <li class="link"><a href="#">Another Item 1</a></li>
                            <li class="link"><a href="#">Another Item 2</a></li>
                            <li class="link"><a href="#">Another Item 3</a></li>
                        </ul>
                    </li>
                    <li class="menuitem link"><a href="#">Contact</a></li>
                    <!-- Search Icon -->
                    <li class="menuitem link">
                        <a id="searchtoggler" href="#">Search</a>
                        <div class="searchbar" id="searchbar">
                            <form action="">
                                <!-- Text Input -->
                                <div class="form-group bar">
                                    <input type="text" class="form-input" id="search-input" placeholder="Enter Search Content">
                                    <button type="button" class="btn btn-primary">Search</button>
                                </div>
                            </form>
                        </div>
                    </li>
                </ul>
            </div> <!-- .navmenuwrap -->
        </nav>

    </div> <!-- .container-fluid -->

    <script src="js/gridbox.js"></script>
    <script>

    // DOM Cache
    var a = im(".link").eachChild();
        dropdown = im(".navmenu-sub"),
        menuToggler = im("#menutoggler"),
        nav = im("#navToggleTarget"),
        searchbar = im("#searchbar"),   // form wrapper
        searchInput = im("#search-input"),  // form input
        searchToggler = im("#searchtoggler"),   // a tag
        form = searchInput.parentUntil("#searchbar");   // used for notClickOn method
        form = form.add(searchToggler).add(searchInput); // include a tag

    // Toggle Sub-menu
    a.each(function(){
        //add click event on each of menu list item
        this.click(function(e){
            e.preventDefault();
            // reset & add .active classes
            a.each(function(){
                this.removeClass("active");
            });
            this.addClass("active");

            // click on menuitem not has .dropdown class
            if(this.parent().hasClass("menuitem") && !this.parent().hasClass("dropdown")){
                dropdown.each(function(){
                    this.removeClass("show");
                });

                if(!this.nextSibling().hasClass("searchbar")){
                    // toggle off searchbar
                    searchbar.removeClass("show");
                }
            }

            // check if next elem is dropdown
            if(this.nextSibling().hasClass("navmenu-sub")){
                if(this.nextSibling().hasClass("show")){
                    this.nextSibling().removeClass("show");
                }else{
                    dropdown.each(function(){
                        this.removeClass("show");
                    });
                    // toggle off searchbar
                    searchbar.removeClass("show");
                    // toggle dropdown menu
                    this.nextSibling().addClass("show");
                }
            }
            
        });
    });

    im(document).notClickOn(a, function(){
        dropdown.each(function(){
            this.removeClass("show");
        });
    });
  
    // Toggle menu
    menuToggler.click(function(e){
        e.preventDefault();

        // reset & add .active classes ONLY when menu not showing
        if(!nav.hasClass("show")){
            a.each(function(){
            this.removeClass("active");
        });
            a.first().addClass("active");
        }

        // toggle menu
        nav.toggleClass("show");
        menuToggler.toggleClass("active");

        // toggle off searchbar
        searchbar.removeClass("show");
    });

    // Search bar Toggle
    searchToggler.click(function(e){
        e.preventDefault();
        
        searchbar.toggleClass("show");

        if(searchbar.hasClass("show")){
            searchInput[0].focus();
        }else{
            searchInput[0].blur();
        }
    });

    im(document).notClickOn(form, function(){
        // toggle off searchbar
        searchbar.removeClass("show");
    });

    </script>
</body>
</html>